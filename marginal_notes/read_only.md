# К вопросу о неизменности.
*Андрей Гончаров*  
*дн dd месяц YYYY завершения написания*    

*Лишь в неизменном — бесконечность,*  
*Лишь в постоянном глубина.*  
*И дальше путь, и ближе вечность,*  
*И всё ясней: любовь одна.*  

*Зинаида Гиппиус*


##### Аннотация
В статье рассматривается концепция неизменности состояния. На примере языка программирования *C#*, показаны способы выражения и достижения неизменности посредствам различных языковых конструкций. Для каждой языковой конструкции *C#* рассматривается ее результат, в смысле достижения неизменности состояния, и смысловая нагрузка, с точки зрения коммуникотивной функции языка. Предлагается способ обозначения неизменности состояния через выделения из интерфейса класса подможества "только для чтения".    

#### Введение

# Сделай это все короче. Просто пара слов и к делу.
Сложно переоценить значение концепций переменной и константы в языках программирования. Они на столько важны, что по тому как в языке реализована поддержка этих концепций, языки делят на три большие группы: те в которых нет констант, те в которых нет переменных, и те в которых эти две концепции поддерживаются одновременно. К первой группе, до выхода ECMAScript 2015, относился *javascript*. Вторая группа представлена функциональными языками, например *F#*. Но наиболее распространненной является третья группа, к ней относятся pyhton, C/C++, C#, Java и т.д.

Что такое константность зависит от контектса. Например это может быть просто число \pi, а может быть идея о незименности данных в сообщении, в ситсеме основанной на *Event Sourcing*. Но, в конечном итоге, неизменность данных необходимо будет выразить некоторыми конструкциями конкретного языка программирования. 

Немного о языках программирования, абстрактно.  

Любой язык программирования, это прежде всего *язык*. Из лингвистике известно[<sup>1</sup>](#1), что одной из функций языка является коммуникативная функция. В контексте языков программироаняи, это выражается в том, что использую различные ключивые слова, конструкции, архитектурные решения, мы передаем некие идеи и мысли тем, кто будет с этим кодом работать дальше. Важно еще и то, что, в большенстве случаев, исходный код - это текст, а текст, в свою очередь, это зафиксированная мысль[<sup>7</sup>](#7). Поэтому выражать свои идеи в коде нужно максимально прозрачным образом. Необходимо стремиться, чтобы количество интерпритаций было минимально. Об этом написано уже не мало литераутры[<sup>8, </sup>](#8)[<sup>9, </sup>](#9)[<sup>10 </sup>](#10). Чтобы прозрачно выражать идеи в коде, нужно хорошо знать язык программирования, на котором код написан, нужно знать во что, в конечном итоге, превращается та или иная конструкция языка, т.к. смысл конструкции может зависить не только от ее "поверхностного" описания, но и от реализации на низком уровне. 


#### 1. Основные конструкции *C#* для выражения константсности.

-------------------------------------------------------------------------
Одной из важных идей/концепций является идея о неизменных дыннах. Эта концепция может встретиться в разных вариантах, на разных уровнях реализации, от простого const, до шаблона ValueObject [ссылка]: # (). 

*В обычной жизни мы больше имеем дело с изменяющимеся сущностями чем с константами. В языках программирования дело обстоит похожим образом: переменная - это более распространненая концепция чем константа. Если рассматривать неизменяемость состояния, как неизменяемость совокупности данных в программе, то необходимо рассмотреть, как эти данные хранятся. Простое определенеие для переменных звучит так: переменная - это именованная область памяти[<sup>2</sup>](#2). Из этого определения видно, что проще обеспечить существование переменных, ибо память в машине, чаще всего, предназначина для многократного переиспользвания - перезаписи. Чтобы запретить запись в какую-либо часть памяти, необходимы дополнительные усилия. Существуют языки программирования где нет констант вообще, например, до выхода ECMAScript 2015, в JS не было констант[<sup>3</sup>](#3). Есть языки, где нет переменных, например к таковым относится большенства функциональных языков[<sup>4, </sup>](#4)[<sup>5</sup>](#5). Но, даже если в языке присутствуют конструкции для создания констант, это не всегда константы в полном понимании слова. Так const в JS[<sup>6</sup>](#6) создает константную ссылку, т.е. нельзя изменить адрес памяти, на которую ссылается константа, но если в этой памяти расположен объект, то его состояние можно изменять. Так, мы снова возвращаемся к вопросу о том, что понимать по неизменностью состояния?*

[//]: # (
Что это?
Переменная и константа, почему константа это сложнее чем переменная. 
Существование языков без переменных и без констант. 
Возможные интерпритации неизменности. 
Проблемы отсутствия неизменности. 
Выражение неизменяемости в языке, для машины, для программиста. 
Формализм и конвенция. 
Плюсы и минусы незименности.)

#### 2. Языковые конструкции C# для выражения постоянства.
[//]: # (
литералы
const
readonly static/nonstatic
struct
readonly struct
ref readonly - оптимизация по памяти, для структур, при возврате.
in param - оптимизация по памяти, для структур, при передаче параметра.
Array и ошибки с ним
IReadOnlyCollection<T>
Шаблон ValueObject)


#### 3. Метод выделения ReadOnly подможества в API класс
[//]: # (
const в объевлении методов в С++, 
const в объявлении переменных,
конструкция const T& - как оптимизация по памяти, с выражением неизменности.)

#### Заключение
[//]: # (О важности и значимости конструкция указывающих на постоянство.)

##### Список литературы
<a class='anchor' id='1'>1</a>. Мартине А. Основы обшей лингвистики \[в:\] Новое в лингвистике. – М., 1963  
<a class='anchor' id='2'>2</a>. <a href="https://ru.wikipedia.org/wiki/%D0%9F%D0%B5%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%BD%D0%B0%D1%8F_(%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5)">(Wiki) Переменная (программирование)</a>  
<a class='anchor' id='3'>3</a>. <a href="https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Statements/const">MDN web docs, const</a>  
<a class='anchor' id='4'>4</a>. <a href="https://ru.wikipedia.org/wiki/%D0%A4%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%BE%D0%BD%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5_%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">Wiki Функциона́льное программи́рование</a>  
<a class='anchor' id='5'>5</a>. <a href="https://ru.wikibooks.org/wiki/Haskell/VariablesAndFunctions#%D0%9F%D0%B5%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%BD%D1%8B%D0%B5_%D0%B2_%D0%B8%D0%BC%D0%BF%D0%B5%D1%80%D0%B0%D1%82%D0%B8%D0%B2%D0%BD%D1%8B%D1%85_%D1%8F%D0%B7%D1%8B%D0%BA%D0%B0%D1%85">Haskell/VariablesAndFunctions / Переменные в императивных языках.</a>  
<a class='anchor' id='6'>6</a>. <a href="https://medium.com/@frontman/const-%D0%B2-js-%D0%B4%D0%B5%D0%BB%D0%B0%D0%B5%D1%82-%D1%81%D0%B2%D0%BE%D1%8E-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%83-%D0%BF%D1%80%D0%B0%D0%B2%D0%B8%D0%BB%D1%8C%D0%BD%D0%BE-b346353d9cce">Александр Майоров CONST в JS делает свою работу правильно! Alexander Mayorov — Pro WEB IT</a>  
<a class='anchor' id='7'>7</a>. <a href="https://ru.wikipedia.org/wiki/Текст">(Wiki) Текст</a>  
<a class='anchor' id='8'>8</a>. <a href="https://www.ozon.ru/context/detail/id/142768363/">Макконнелл С. Совершенный код. Мастер-класс / БХВ-Петербург, 2017</a>  
<a class='anchor' id='9'>9</a>. <a href="https://www.ozon.ru/context/detail/id/4187085/">Идеальный код / Под ред. Энди Орам, Грегори Уилсон. – Питер, 2009.</a>  
<a class='anchor' id='10'>10</a>. <a href="https://www.ozon.ru/context/detail/id/4187085/">Мартин Фаулер, Кент Бек, Джон Брант, Дон Робертс Рефакторинг. Улучшение проекта существующего кода / Вильямс, 2017.</a>  


