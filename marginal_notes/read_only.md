# К вопросу о неизменности.
*Андрей Гончаров*  
*дн dd месяц YYYY завершения написания*    

*Лишь в неизменном — бесконечность,*  
*Лишь в постоянном глубина.*  
*И дальше путь, и ближе вечность,*  
*И всё ясней: любовь одна.*  

*Зинаида Гиппиус*


##### Аннотация
В статье рассматривается концепция неизменности состояния. На примере языка программирования *C#*, показаны способы выражения и достижения неизменности посредствам различных языковых конструкций. Для каждой языковой конструкции *C#* рассматривается ее результат, в смысле достижения неизменности состояния, и смысловая нагрузка, с точки зрения коммуникотивной функции языка. Предлагается способ обозначения неизменности состояния через выделения из интерфейса класса подможества "только для чтения".    

#### Введение
Сложно переоценить значение концепций переменной и константы в языках программирования. Эти две кнцепции на столько важны, что по тому как в языке реализована их поддержка, язык будет отнесен к одной из трех групп: те в которых нет констант, те в которых нет переменных, и те в которых эти две концепции поддерживаются одновременно. Примером языков первой группы являлся *javascript*, до ECMAScript 2015. Ко второй группе относятся функциональные языки, такие как *F#*. Но большенство языков, все же, пытаются дать программистам возможность использовать обе концепции.

Что такое константность зависит от контектса. То что поддерживается в языках программирования - это, скажем так, элементарная константность, т.е. неизменность данных в некоторой обласит памяти, обеспечиваемая на уровне исполняемого кода. Когда мы пишем const, то язык программирования гарантирует, по крайней мере мы от него этого ожидаем, что попытка изменить данный в области памяти помеченной как const приведут к ошибке.

Но константность может быть и более выского уровня, например, незименность данных содержащихся в событии, в event-driven(ссылка на видео) системах. Но даже константность более высокого уровня, в конечном итоге, будет выражена в конструкциях конкретного языка программирования.   

Пара слов о языках программирования.  

Любой язык программирования, это прежде всего *язык*. Из лингвистике известно что одной из функций языка[<sup>1</sup>](#1), и для языков программирования это справедливо, является коммуникативная функция. Использвую различные ключивые слова, конструкции, архитектурные решения, мы передаем некие идеи и мысли тем, кто будет этот код читать, анализировать, интерпритировать.  
Да, в большенстве случаев, исходный код - это текст, а текст, свою очередь это зафиксированная мысль. Поэтому выражать свои идеи в коде нужно максимально прозрачным образом. Необходимо стремиться, чтобы количество интерпритаций текста было минимально.   
Конечно, когда мы говорим об интерпритации/компиляции кода машиной, то тут не бывает разночтений - машина исполняет только то, что написано в программе. Машине все-равно *как* написана программа, главное чтобы она была корректна. А вот человеку, другому программисту, это совсем не все равно.  

Отмечу что смысл конструкций может скрываться не только в их общем описании, но, также, и в реализации этих конструкций на более низком уровне. Чтобы ясно выражать мысль в программном коде, надо **точно** понимать смысл конструкций, которыми вы пытаетесь выразить эту мысль. 


#### 1. Основные конструкции *C#* для выражения константсности.

-------------------------------------------------------------------------
Одной из важных идей/концепций является идея о неизменных дыннах. Эта концепция может встретиться в разных вариантах, на разных уровнях реализации, от простого const, до шаблона ValueObject [ссылка]: # (). 

*В обычной жизни мы больше имеем дело с изменяющимеся сущностями чем с константами. В языках программирования дело обстоит похожим образом: переменная - это более распространненая концепция чем константа. Если рассматривать неизменяемость состояния, как неизменяемость совокупности данных в программе, то необходимо рассмотреть, как эти данные хранятся. Простое определенеие для переменных звучит так: переменная - это именованная область памяти[<sup>2</sup>](#2). Из этого определения видно, что проще обеспечить существование переменных, ибо память в машине, чаще всего, предназначина для многократного переиспользвания - перезаписи. Чтобы запретить запись в какую-либо часть памяти, необходимы дополнительные усилия. Существуют языки программирования где нет констант вообще, например, до выхода ECMAScript 2015, в JS не было констант[<sup>3</sup>](#3). Есть языки, где нет переменных, например к таковым относится большенства функциональных языков[<sup>4, </sup>](#4)[<sup>5</sup>](#5). Но, даже если в языке присутствуют конструкции для создания констант, это не всегда константы в полном понимании слова. Так const в JS[<sup>6</sup>](#6) создает константную ссылку, т.е. нельзя изменить адрес памяти, на которую ссылается константа, но если в этой памяти расположен объект, то его состояние можно изменять. Так, мы снова возвращаемся к вопросу о том, что понимать по неизменностью состояния?*

[//]: # (
Что это?
Переменная и константа, почему константа это сложнее чем переменная. 
Существование языков без переменных и без констант. 
Возможные интерпритации неизменности. 
Проблемы отсутствия неизменности. 
Выражение неизменяемости в языке, для машины, для программиста. 
Формализм и конвенция. 
Плюсы и минусы незименности.)

#### 2. Языковые конструкции C# для выражения постоянства.
[//]: # (
литералы
const
readonly static/nonstatic
struct
readonly struct
ref readonly - оптимизация по памяти, для структур, при возврате.
in param - оптимизация по памяти, для структур, при передаче параметра.
Array и ошибки с ним
IReadOnlyCollection<T>
Шаблон ValueObject)


#### 3. Метод выделения ReadOnly подможества в API класс
[//]: # (
const в объевлении методов в С++, 
const в объявлении переменных,
конструкция const T& - как оптимизация по памяти, с выражением неизменности.)

#### Заключение
[//]: # (О важности и значимости конструкция указывающих на постоянство.)

##### Список литературы
<a class='anchor' id='1'>1</a>. Мартине А. Основы обшей лингвистики \[в:\] Новое в лингвистике. – М., 1963  
<a class='anchor' id='2'>2</a>. <a href="https://ru.wikipedia.org/wiki/%D0%9F%D0%B5%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%BD%D0%B0%D1%8F_(%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5)">(Wiki) Переменная (программирование)</a>  
<a class='anchor' id='3'>3</a>. <a href="https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Statements/const">MDN web docs, const</a>  
<a class='anchor' id='4'>4</a>. <a href="https://ru.wikipedia.org/wiki/%D0%A4%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%BE%D0%BD%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5_%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">Wiki Функциона́льное программи́рование</a>
<a class='anchor' id='5'>5</a>. <a href="https://ru.wikibooks.org/wiki/Haskell/VariablesAndFunctions#%D0%9F%D0%B5%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%BD%D1%8B%D0%B5_%D0%B2_%D0%B8%D0%BC%D0%BF%D0%B5%D1%80%D0%B0%D1%82%D0%B8%D0%B2%D0%BD%D1%8B%D1%85_%D1%8F%D0%B7%D1%8B%D0%BA%D0%B0%D1%85">Haskell/VariablesAndFunctions / Переменные в императивных языках.</a>

<a class='anchor' id='6'>6</a>. <a href="https://medium.com/@frontman/const-%D0%B2-js-%D0%B4%D0%B5%D0%BB%D0%B0%D0%B5%D1%82-%D1%81%D0%B2%D0%BE%D1%8E-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%83-%D0%BF%D1%80%D0%B0%D0%B2%D0%B8%D0%BB%D1%8C%D0%BD%D0%BE-b346353d9cce">Александр Майоров CONST в JS делает свою работу правильно! Alexander Mayorov — Pro WEB IT</a>
